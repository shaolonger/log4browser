!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).Log4Browser=r()}(this,(function(){"use strict";function e(r){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function r(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function n(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var i={projectIdentifier:"",captureJsError:!0,captureResourceError:!0,captureAjaxError:!0,captureConsoleError:!1,isAutoHandle:!0},s="error",a="JS_ERROR",c="RESOURCE_LOAD_ERROR",l="HTTP_ERROR",d="CUSTOM_ERROR",p=function(){var e={},r=navigator.userAgent,t=r.match(/(Android);?[\s\/]+([\d.]+)?/),o=r.match(/(iPad).*OS\s([\d_]+)/),n=r.match(/(iPod)(.*OS\s([\d_]+))?/),i=!o&&r.match(/(iPhone\sOS)\s([\d_]+)/),s=r.match(/Android\s[\S\s]+Build\//);if(e.ios=e.android=e.iphone=e.iPad=e.androidChrome=!1,e.isWeixin=/MicroMessenger/i.test(r),e.os="web",e.deviceName="PC",t&&(e.os="android",e.osVersion=t[2],e.android=!0,e.androidChrome=r.toLowerCase().indexOf("chrome")>=0),(o||i||n)&&(e.os="ios",e.ios=!0),i&&!n&&(e.osVersion=i[2].replace(/_/g,"."),e.iphone=!0),o&&(e.osVersion=o[2].replace(/_/g,"."),e.iPad=!0),n&&(e.osVersion=n[3]?n[3].replace(/_/g,"."):null,e.iphone=!0),e.ios&&e.osVersion&&r.indexOf("Version/")>=0&&"10"===e.osVersion.split(".")[0]&&(e.osVersion=r.toLowerCase().split("version/")[1].split(" ")[0]),e.iphone){e.deviceName="iphone";var a=window.screen.width,c=window.screen.height;320===a&&480===c?e.deviceName="iphone 4":320===a&&568===c?e.deviceName="iphone 5/SE":375===a&&667===c?e.deviceName="iphone 6/7/8":414===a&&736===c?e.deviceName="iphone 6/7/8 Plus":375===a&&812===c&&(e.deviceName="iphone X/S/Max")}else if(e.iPad)e.deviceName="iPad";else if(s){var l=s[0].split(";")[1].replace(/Build\//g,"");e.deviceName=l.replace(/(^\s*)|(\s*$)/g,"")}if(-1===r.indexOf("Mobile")){var d=navigator.userAgent.toLowerCase();if(e.browserName="Unknown",d.indexOf("msie")>0){var p=d.match(/msie [\d.]+;/gi)[0];e.browserName=p.split("/")[0],e.browserVersion=p.split("/")[1]}if(d.indexOf("firefox")>0){var u=d.match(/firefox\/[\d.]+/gi)[0];e.browserName=u.split("/")[0],e.browserVersion=u.split("/")[1]}if(d.indexOf("safari")>0&&d.indexOf("chrome")<0){var f=d.match(/safari\/[\d.]+/gi)[0];e.browserName=f.split("/")[0],e.browserVersion=f.split("/")[1]}if(d.indexOf("chrome")>0){var h=d.match(/chrome\/[\d.]+/gi)[0];e.browserName=h.split("/")[0],e.browserVersion=h.split("/")[1]}}return e.webView=(i||o||n)&&r.match(/.*AppleWebKit(?!.*Safari)/i),e}(),u=function(){var e,r,t,o,i,s,a,c,l,d,u=window.returnCitySN||{},f={happenTime:(t=function(e){return("00"+e).substr(-2)},o=new Date,i=o.getFullYear(),s=t(o.getMonth()+1),a=t(o.getDate()),c=t(o.getHours()),l=t(o.getMinutes()),d=t(o.getSeconds()),"".concat(i,"-").concat(s,"-").concat(a," ").concat(c,":").concat(l,":").concat(d)),deviceName:p.deviceName,os:p.os,osVersion:p.osVersion,browserName:p.browserName,browserVersion:p.browserVersion,netType:(e=navigator.userAgent,r=e.match(/NetType\/\w+/)?e.match(/NetType\/\w+/)[0]:"NetType/other",r=r.toLowerCase().replace("nettype/","")),ipAddress:u.cip,address:u.cname},h=function(){var e="",r="";if(window&&window.location){var t=window.location,o=t.href,n=t.hash,i=t.pathname;e=o,r=n||i}return{pageUrl:e,pageKey:r}}();return n(n({},f),h)},f=function(e,r,t,o){return Object.assign({},u(),{projectIdentifier:e,logType:a,errorType:r,errorMessage:t,errorStack:o,level:s})};return function(){function t(){var e;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),(e=document.createElement("script")).type="text/javascript",e.src="http://pv.sohu.com/cityjson?ie=utf-8",e.onload=function(){e.parentNode.removeChild(e),e=null},document.body.append(e)}var o,n,a;return o=t,(n=[{key:"init",value:function(e){this.config=Object.assign({},i,e),this.config.captureJsError&&(this.handleJsError(this.config),this.handlePromiseRejectError(this.config)),this.config.captureResourceError&&this.handleResourceError(this.config),this.config.captureAjaxError&&this.handleAjaxError(this.config),this.config.captureConsoleError&&this.handleConsoleError(this.config)}},{key:"handleJsError",value:function(e){window.onerror=function(r,t,o,n,i){var s="",a="",c="";i&&i instanceof Error?(s=i.name||"",a=i.message||r||"",c=i.stack||""):(s="Others",a=r||"",c=""),e.isAutoHandle&&e.errorHandler(f(e.projectIdentifier,s,a,c))}}},{key:"handlePromiseRejectError",value:function(r){window.onunhandledrejection=function(t){var o="",n="";"object"===e(t.reason)?(o=t.reason.message,n=t.reason.stack):(o=t.reason,n=""),r.isAutoHandle&&r.errorHandler(f(r.projectIdentifier,"UncaughtInPromiseError",o,n))}}},{key:"handleResourceError",value:function(e){window.addEventListener("error",(function(r){var t=r.target||r.srcElement;if(t instanceof HTMLScriptElement||t instanceof HTMLLinkElement||t instanceof HTMLImageElement){var o=r.target.localName,n="";"link"===o?n=r.target.href:("script"===o||"img"===o)&&(n=r.target.src),e.isAutoHandle&&e.errorHandler(Object.assign({},u(),{projectIdentifier:e.projectIdentifier,logType:c,resourceUrl:n,resourceType:o,status:"0",level:s}))}}),!0)}},{key:"handleAjaxError",value:function(e){if(window.fetch){var r=window.fetch;window.fetch=function(){var t=arguments;return r.apply(this,arguments).then((function(r){return r.ok||e.isAutoHandle&&e.errorHandler(Object.assign({},u(),{projectIdentifier:e.projectIdentifier,logType:l,httpUrlComplete:t[0],httpUrlShort:t[0],status:r,statusText:r,level:s})),r})).catch((function(r){e.isAutoHandle&&e.errorHandler(Object.assign({},u(),{projectIdentifier:e.projectIdentifier,logType:l,httpUrlComplete:t[0],httpUrlShort:t[0],status:r.message,statusText:r.stack,level:s}))}))}}if(window.XMLHttpRequest){var t=window.XMLHttpRequest,o=t.prototype.open,n=t.prototype.send,i=function(r){r&&r.currentTarget&&200!==r.currentTarget.status&&e.isAutoHandle&&e.errorHandler(Object.assign({},u(),{projectIdentifier:e.projectIdentifier,logType:l,httpUrlComplete:r.target.responseURL||this._url,httpUrlShort:r.target.response||this._url,status:r.target.status,statusText:r.target.statusText,level:s}))};t.prototype.open=function(e,r){this._url=r;for(var t=arguments.length,n=new Array(t>2?t-2:0),i=2;i<t;i++)n[i-2]=arguments[i];return o.apply(this,[e,r].concat(n))},t.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",i),this.addEventListener("load",i),this.addEventListener("abort",i);else{var e=this.onreadystatechange;this.onreadystatechange=function(r){4===this.readyState&&i(r),e&&e.apply(this,arguments)}}return n.apply(this,arguments)}}}},{key:"handleConsoleError",value:function(e){if(window.console&&window.console.error){var r=window.console.error;window.console.error=function(t){var o=arguments[0]&&arguments[0].message||t,n=arguments[0]&&arguments[0].stack;return e.isAutoHandle&&e.errorHandler(Object.assign({},u(),{projectIdentifier:e.projectIdentifier,logType:d,errorType:d,errorMessage:o,errorStack:n})),r.apply(window.console,arguments)}}}},{key:"setIsAutoHandle",value:function(e){this.config.isAutoHandle=!!e}}])&&r(o.prototype,n),a&&r(o,a),t}()}));
